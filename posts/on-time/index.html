<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="On Time - Adding a Stratum 1 Time Source" /><meta property="og:locale" content="en" /><meta name="description" content="Relying on the internet for time seems a little silly to me when we have high-tech objects speeding past over-head giving us an incredibly accurate, non-connected time source, most folks call it GPS." /><meta property="og:description" content="Relying on the internet for time seems a little silly to me when we have high-tech objects speeding past over-head giving us an incredibly accurate, non-connected time source, most folks call it GPS." /><link rel="canonical" href="https://vk2way.id.au/posts/on-time/" /><meta property="og:url" content="https://vk2way.id.au/posts/on-time/" /><meta property="og:site_name" content="VK2WAY" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-02T00:00:00+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="On Time - Adding a Stratum 1 Time Source" /><meta name="twitter:site" content="@jaredquinn" /><meta name="google-site-verification" content="" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://vk2way.id.au/posts/on-time/"},"description":"Relying on the internet for time seems a little silly to me when we have high-tech objects speeding past over-head giving us an incredibly accurate, non-connected time source, most folks call it GPS.","@type":"BlogPosting","headline":"On Time - Adding a Stratum 1 Time Source","dateModified":"2022-01-02T00:00:00+11:00","datePublished":"2022-01-02T00:00:00+11:00","url":"https://vk2way.id.au/posts/on-time/","@context":"https://schema.org"}</script><title>On Time - Adding a Stratum 1 Time Source | VK2WAY</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="VK2WAY"><meta name="application-name" content="VK2WAY"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/me.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">VK2WAY</a></div><div class="site-subtitle font-italic">Jared Quinn</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fas fa-envelope ml-xl-3 mr-xl-3 unloaded"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/jaredquinn" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/jaredquinn" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cq','vk2way.id.au'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>On Time - Adding a Stratum 1 Time Source</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>On Time - Adding a Stratum 1 Time Source</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Jared Quinn </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 2, 2022, 12:00 AM +1100" >Jan 2<i class="unloaded">2022-01-02T00:00:00+11:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2228 words">12 min read</span></div></div><div class="post-content"><p>Relying on the internet for time seems a little silly to me when we have high-tech objects speeding past over-head giving us an incredibly accurate, non-connected time source, most folks call it GPS.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Project Cost<th style="text-align: left">Build Time<th style="text-align: left">Assumed Knowledge<tbody><tr><td style="text-align: left">$10-$60<td style="text-align: left">4hrs<td style="text-align: left">Basic Linux<br />Familiarity with Single Board Computers (eg Raspberry Pi)<tr><td style="text-align: left">¬†<td style="text-align: left">¬†<td style="text-align: left">Minimum Electronics Knowledge (GPIO Use)</table></div><h1 id="background">Background</h1><h2 id="but-isnt-gps-about-location">But isn‚Äôt GPS about location?</h2><p>GPS is a system of 30+ navigation satellites circling Earth. A GPS receiver in your phone or other device listens for these signals. Using the time it takes signals to travel at the speed of light from the satellite to the receiver a location can be triangulated, often using 8 or more of the satellites available. In order to do this GPS satellites utilise multiple onboard atomic clocks - as clocks must be accurately synchronised in order to calculate the distances accurately.</p><p>Even these small atomic clocks on GPS can drift over time and an update is sent to each of them twice a day to keep their time in sync with larger, more accurate, earth-based atomic clocks, that could not survive the journey to space.</p><p>GPS broadcasts it‚Äôs signals using two frequencies known as L1 at 1575.42Mhz and L2 at 1227.6Mhz with timing signals and binary data known as alamanac and ephemeris. Spread spectrum signals are handled by using unique frequency hopping coding, uniquely idenitfying each satellite.</p><p>If you‚Äôd like to deep-dive into the nitty-gritty technical details on how the Global Positioning System network works, the Australian Institute of Measurement‚Äôs Dr Bruce Warrington produced an excellent slide deck available in PDF from Engineers Australia entitled <a href="https://www.engineersaustralia.org.au/sites/default/files/resource-files/2017-01/GPS%20and%20Time%20-%20Dr_%20Warrington.pdf">GPS and Time: Using Clocks in Space for Accurate Time on the Ground</a> üìÑ‚Üó</p><p>The term stratum means the same here as it does geologically, ‚Äúa layer or a series of layers of rock in the ground.‚Äù, though we‚Äôre talking about layers of accuracy in a time source, a clock receiving it‚Äôs time from a stratum 4 source is in itself a stratum 5 clock. The GPS clock in our configuration here is a Stratum 0 clock providing it‚Äôs time to a Stratum 1 time server.</p><h1 id="hardware">Hardware</h1><h2 id="gps-modules">GPS Modules</h2><p>Just about all GPS modules available utilise TTL-level UART (Serial) connectivity to deliver their data to a host. If you want accurate time keeping you also want a PPS (Pulse-Per-Second) signal from the module, allowing the host to perform an interrupt on this line and keep the clock in sync every second.</p><p>All my early tests were conducted with a cheap GPS reciever designed for drones; though it appears many on the market are based on this chipset.</p><ul><li><a href="https://amzn.to/3FMBZVX">Neo 6M v2 GPS Receiver and Antenna</a> üõí</ul><p>You can get PPS from one of these modules if you‚Äôre really keen, see below for more details.</p><p>If you‚Äôd prefer a pre-built waterproof enclosure that includes the PPS line, you could consider an item more like this USB-based device, which has the benefit of not requiring any GPIO connectivity or soldering.</p><ul><li><a href="https://amzn.to/3pKEm5V">VK-162 G-Mouse USB GPS Dongle Navigation Module External</a> üõí</ul><p>Computer - As the Planespotting project is in production in the bedroom window with access for external small receiver antennas, the ADS-B project was selected to host the GPS clock after testing was done with the Balcony Test rig. The ARM Core processor in this Orange Pi is more than capable of providing multiple services:</p><p><a href="/posts/adsb/">ADS-B Reciever</a> - Orange Pi based PlaneSpotting</p><h3 id="getting-pps-from-a-module-without-it">Getting PPS from a Module without it</h3><p>On the Neo modules without PPS broken out, you can do it yourself if you‚Äôre keen:</p><p><img data-proofer-ignore data-src="/posts/on-time/al-pins.jpg" alt="PPS Pin on Chip" /></p><p>This image and more info can be found at Alan Cashin‚Äôs <a href="http://www.cashin.net/sidereal/circuit.html">A Low Cost Sidereal Clock</a>‚Üó page. Used with permission.</p><h2 id="tread-carefully">Tread Carefully</h2><p>Be careful with the connectors and antenna for the Neo modules; on day 1 of experimenting I borked mine pretty badly; it took much time and effort to split and solder the tiny connector cable bac inside the antenna, it was midly successful for the remainder of early testing until a replacement unit arrived a week later.</p><p><img data-proofer-ignore data-src="/posts/on-time/brokeit.png" alt="Broke the Antenna" /></p><h2 id="getting-wired-up">Getting Wired Up</h2><p><em>Skip this section if you‚Äôre using a USB module.</em></p><p>If you‚Äôre going with the Neo module; you‚Äôll need to get your TTL UART TX/RX lines and VCC/GND connected up to a suitable serial port. On the Orange Pi I already had in production the most convenient pins for this were UART2 as they are handy to 3V3 and GND lines on the GPIO header pins.</p><p><img data-proofer-ignore data-src="/posts/on-time/uart.jpg" alt="Orange Pi PinOut" /></p><p>We connect the RX line from the Neo module to the TX line of the Orange Pi and the TX line to the Orange Pi‚Äôs RX line. As usual, VCC to 3V3 and GND to GND. I soldered and heatshrank female DuPont headers to the lines to make them easy to connect and disconnect from my various Orange Pi setups. GPIO3 makes a good candidate for the PPS interrupt line, especially if you‚Äôre using DuPont headers as I find that they hold better when neighbouring pins are also occupied. The usual advice of <em>if it‚Äôs semi-permanent just solder it</em>, always applies!</p><p><img data-proofer-ignore data-src="/posts/on-time/wiring.png" alt="Heatshrinked Wiring" /></p><p>This is my original test wiring, before using a PPS line for more accurate time keeping. Note the use of heatshrinking - solder of course under it, but I <em>love</em> heatshrink.</p><p>You‚Äôll need to use the <code class="language-plaintext highlighter-rouge">armbian-config</code> command to setup UART2 (which appears as /dev/ttyS2) and the gpio-pps kernel modules; you can do this on the command line if you wish, but runnig armbian-config, selecting System and Hardware is the easiest option. Once these kernel modules are installed, reboot and we‚Äôre ready to install some software.</p><p><img data-proofer-ignore data-src="/posts/on-time/armbianconfig.png" alt="Armbian Config" /></p><p>The Module defaults to 9600 baud serial, 8 bits, No Parity, 1 stop bit. There are no CTS/RTS connections required.</p><p>Of course if you opted for the USB model you can skip this wiring step and plug in the USB cable!</p><h1 id="the-software">The Software</h1><h2 id="installing-the-software">Installing the Software</h2><p>At bare minimum for a production system you‚Äôll want the universal GPS daemon - <code class="language-plaintext highlighter-rouge">gpsd</code> and the related client tools found in the debian <code class="language-plaintext highlighter-rouge">gpsd-clients</code> package. For debugging purposes you may also want miniterm found in the pyserial/python-serial package. A modern network time server is essential if you want to share the time from your new GPS clock to the rest of your network, I recommend <code class="language-plaintext highlighter-rouge">ntpsec</code>, a secure, hardened, and improved implementation of Network Time Protocol derived from NTP Classic, Dave Mills‚Äôs original.</p><p>I‚Äôm a python dev primarilly so I added the python libraries for GPS too to have a play with in future.</p><p>Let‚Äôs get the entire collection of suggested tools installed, inluding a couple of dependencies:</p><div file="shell" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="shell"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>apt update 
apt install miniterm pyserial python3-serial python3-gps python-gps gpsd gpsd-clients ntpsec  
</pre></table></code></div></div><h2 id="configuring-gpsd">Configuring GPSd</h2><p>I found just letting gpsd do it‚Äôs own thing with minimal instruction tends to work best, so edit the <code class="language-plaintext highlighter-rouge">/etc/default/gpsd</code> configuration file with your preferred text editor and update it to reflect your serial port device and -n which makes gpsd start using the device immediately rather than waiting in a low-power standby mode until it‚Äôs needed:</p><div file="/etc/default/gpsd" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="/etc/default/gpsd"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>DEVICES="/dev/ttyS2"
GPSD_OPTIONS="-n"
</pre></table></code></div></div><p>and tell armbian to enable and start the gps server.</p><div file="shell" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="shell"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>systemctl enable gpsd
systemctl start gpsd
</pre></table></code></div></div><p>Now, ensure your antenna is connected to the module and has a good clear view of the sky without obstructions that will interfere with signals at the 1 gigahertz range that GPS operates in; and run <code class="language-plaintext highlighter-rouge">gpsmon</code> to see what your GPS is doing!</p><p><img data-proofer-ignore data-src="/posts/on-time/gpsmon.jpg" alt="GPS Mon" /></p><p>If all goes well you‚Äôll see a count of the satellites connected and the current time and location (mine is redacted of course). The output of gpsmon may differ depending on the protocol being used with your GPS receiver, but all modes will result in an accurate time, location and quality indication (number of satellites used). If you‚Äôd like to do a deep-dive into the actual protocol used to exchange data between the module and host you can take a look at the <a href="https://www.nmea.org/content/STANDARDS/NMEA_0183_Standard">NMEA 183 standard</a> ‚Üó.</p><h2 id="configuring-ntp-for-network-time">Configuring NTP for Network Time</h2><p>Having been a sysadm since the late 90s; I‚Äôm reluctant to look at the ‚Äòmodern‚Äô NTP replacements like chrony, but I hear good things about them. The original <code class="language-plaintext highlighter-rouge">ntpd</code> by Dave Mills has been around forever and has some security issues, but a team of amazing volunteers has taken on this project and produced <code class="language-plaintext highlighter-rouge">ntpsec</code>, I highly recommend this option, so that‚Äôs the one detailed here.</p><p>We can ignore the <code class="language-plaintext highlighter-rouge">/etc/default/ntpsec</code> file in this case; as it‚Äôs just sensible defaults; instead we‚Äôll take a look at <code class="language-plaintext highlighter-rouge">/etc/ntpsec/ntp.conf</code>, and the lines specifically for adding a shared memory or virtual network clock, these psuedo addresses are used for different types of clocks with 127.127.1.0 reserved for your local systemclock (not something that you should use); here‚Äôs some of the virtual network clocks defined by the NTP standard:</p><ul><li>Type 1 Undisciplined Local Clock (LOCAL)<li>Type 8 Generic Reference Driver (PARSE)<li>Type 17 Datum Precision Time System (GPS_DATUM)<li>Type 20 Generic NMEA GPS Receiver (NMEA)<li>Type 22 PPS Clock Discipline (PPS)<li>Type 28 Shared Memory Driver (SHM)<li>Type 30 Motorola UT Oncore GPS GPS_ONCORE)<li>Type 33 Dumb Clock (DUMBCLOCK)<li>Type 36 Radio WWV/H Audio Demodulator/Decoder (WWV)<li>Type 46 GPSD NG client protoco</ul><p>As our gps server and ntp server run on the same network we‚Äôre going to use the shared memory (28) driver, so add these two lines to the configuration:</p><div file="/etc/ntpsec/ntp.conf" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="/etc/ntpsec/ntp.conf"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>‚Ä¶
server 127.127.28.0 minpoll 4 maxpoll 4 prefer
fudge 127.127.28.0 time1 0.0 refid GPS stratum 15
‚Ä¶
</pre></table></code></div></div><p>Ensure that ntpsec is enabled and start it off to test the GPS shared memory clock.</p><div file="shell" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="shell"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>systemctl enable ntpsec
systemctl start ntpsec
</pre></table></code></div></div><p>We‚Äôll cover the <code class="language-plaintext highlighter-rouge">fudge</code> line shortly, but for now the important thing to remember is to force this as a low-stratum clock (15) while we‚Äôre testing as to not affect our current network time until we‚Äôre ready to do so. We give it a reference ID (GPS) and an offset, that offset we will adjust soon.</p><p>There‚Äôs other settings in this file you may want to look at like including some internet time sources as well; and armbian by default will use the public ubuntu pool of time servers.</p><h1 id="did-it-work">Did it work?</h1><p>Like <code class="language-plaintext highlighter-rouge">gpsd</code>, our time server has a tool which can be used to see how it‚Äôs performing; that tool is <code class="language-plaintext highlighter-rouge">ntpq</code> (network time protocol query), so we run the command <code class="language-plaintext highlighter-rouge">ntpq -c peers</code> on our sOrange Pi:</p><div file="output of ntpq -c peers" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="output of ntpq -c peers"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>     remote                                   refid      st t when poll reach   delay   offset   jitter
=======================================================================================================
*catsl################.org               139.99.222.72    3 u   11   32  377   0.3650  -0.0437   0.1351
 serenity.catslair                       .DNS.           16 u    -   32    0   0.0000   0.0000   0.0010
 SHM(0)                                  .GPS.           15 l    6   16  377   0.0000 -116.439   2.0221
 time.cloudflare.com                     .NTS.           16 7    -  512    0   0.0000   0.0000   0.0010
 au.pool.ntp.org                         .POOL.          16 p    - 1024    0   0.0000   0.0000   0.0010
-y.ns.gin.ntt.net                        204.2.140.74     2 u  618 1024    1  14.0685   2.3213   0.1256
+time.cloudflare.com                     10.26.9.65       3 u  618 1024    1  14.0051   1.3210   0.1326
+ntp3.ds.network                         218.100.43.70    2 u  618 1024    1  62.0535  -0.5893   0.1282
-pauseq4vntp2.datamossa.io               203.35.83.242    2 u  362 1024    1  15.3318   1.7495   0.4183
-dns01.ntl02.privatecloudco.com          110.142.180.39   2 u  362 1024    1  19.8433  -0.8128   0.2023
+ntp2.ds.network                         162.159.200.123  4 u  362 1024    1  62.9446  -0.4334   0.2466
</pre></table></code></div></div><p>NTP is usually very good at picking the best time sources; and reading the output above the first thing to notice is that SHM(0) (GPS) has a stratum 15 value - which is great, I don‚Äôt want it being authoritive in anyway until we‚Äôre sure of it‚Äôs accuracy.</p><p>The offset is a concern, but we‚Äôll keep an eye on this over a day or so to see how it goes. You could write a quick shell script to reguarly run peers and record the value if you want a good dataset - but that‚Äôs probably excessive.</p><div file="/etc/ntpsec/ntp.conf" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="/etc/ntpsec/ntp.conf"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>‚Ä¶
fudge 127.127.28.0 time1 .1229 refid GPS stratum 15
‚Ä¶
</pre></table></code></div></div><p>Play with the time1 value on the fudge line to adjust the offset to bring it inline with a low-stratum network time source. I found the value of .1229 worked well for me (and is close to the 116 milliseconds reported by peers initially.</p><p>Once you‚Äôve got this value sorted, we can remove the fudged stratum setting and let ntp treat this like any other clock available to it:</p><div file="/etc/ntpsec/ntp.conf" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="/etc/ntpsec/ntp.conf"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>‚Ä¶
server 127.127.28.0 minpoll 4 maxpoll 4 prefer
fudge 127.127.28.0 time1 .1229 refid GPS
‚Ä¶
</pre></table></code></div></div><p>Leaving NTP running for a little while (15 minutes or so), we come back to check on it again:</p><div file="output of ntpq -c peers" class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data="output of ntpq -c peers"><i class="fa-fw far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>     remote                                   refid      st t when poll reach   delay   offset   jitter
=======================================================================================================
*catsla#########.org                     220.158.215.21   3 u   23   32  377   0.6142   0.0055   0.0864
 serenity.catslair                       .DNS.           16 u    -   32    0   0.0000   0.0000   0.0019
+SHM(0)                                  .GPS.            0 l    8   16  377   0.0000  -2.7497   2.9595
 time.cloudflare.com                     .NTS.           16 7    -  512    0   0.0000   0.0000   0.0019
 au.pool.ntp.org                         .POOL.          16 p    - 1024    0   0.0000   0.0000   0.0019
+220-158-215-21.broadband.telesmart.co.n 202.46.178.18    2 u  876 1024    1  14.7812  -0.6275   0.1317
-table-moral.bnr.la                      203.35.83.242    2 u  876 1024    1  26.4353   1.6811   0.1150
+time.cloudflare.com                     10.26.9.65       3 u  876 1024    1  13.8727   1.3652   0.3772
+ntp2.ds.network                         162.159.200.123  4 u  620 1024    1  62.9110  -0.2905   0.1322
-combine-window.bnr.la                   110.142.180.39   2 u  620 1024    1  25.0696   0.9505   0.1876
-220-158-215-20.broadband.telesmart.co.n 202.46.178.18    2 u  620 1024    1  14.3489  -1.0887   0.3111
</pre></table></code></div></div><p>We have a slight offset, and a huge jitter (which will be fixed when the PPS is finally connected) but a useable time!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/radio/'>Radio</a>, <a href='/categories/gps/'>GPS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/software/" class="post-tag no-text-decoration" >software</a> <a href="/tags/pi/" class="post-tag no-text-decoration" >pi</a> <a href="/tags/gps/" class="post-tag no-text-decoration" >gps</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=On Time - Adding a Stratum 1 Time Source - VK2WAY&url=https://vk2way.id.au/posts/on-time/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=On Time - Adding a Stratum 1 Time Source - VK2WAY&u=https://vk2way.id.au/posts/on-time/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=On Time - Adding a Stratum 1 Time Source - VK2WAY&url=https://vk2way.id.au/posts/on-time/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homeassistant/">homeassistant</a> <a class="post-tag" href="/tags/smarthome/">smarthome</a> <a class="post-tag" href="/tags/pi/">pi</a> <a class="post-tag" href="/tags/sdr/">sdr</a> <a class="post-tag" href="/tags/esp/">esp</a> <a class="post-tag" href="/tags/sbc/">sbc</a> <a class="post-tag" href="/tags/software/">software</a> <a class="post-tag" href="/tags/camera/">camera</a> <a class="post-tag" href="/tags/can/">can</a> <a class="post-tag" href="/tags/gps/">gps</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/prettyfly/"><div class="card-body"> <span class="timeago small" >Nov 2, 2021<i class="unloaded">2021-11-02T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PrettyFly (Emoji Heavy) ADS-B Report Generator</h3><div class="text-muted small"><p> Warning: This is a work in progress PrettyFly is a first attempt at turning ADS-B data into interesting reports; it depends on Tar1090 from wiedehopf. PrettyFly is currently only able to travel ...</p></div></div></a></div><div class="card"> <a href="/posts/adsb/"><div class="card-body"> <span class="timeago small" >Oct 26, 2021<i class="unloaded">2021-10-26T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Planespotting - My ADS-B Setup</h3><div class="text-muted small"><p> Ever wondered where FlightAware or FlightRadar get all the info they show on their sites? Folks like me (and maybe you too!). This article describes what ADS-B is, how I receive it and how I disp...</p></div></div></a></div><div class="card"> <a href="/posts/balcony-multi-cam/"><div class="card-body"> <span class="timeago small" >Dec 1, 2021<i class="unloaded">2021-12-01T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Balcony Multi-System (Radio and Camera)</h3><div class="text-muted small"><p> Starting from a coffee table next to my balcony and an RG58 cable running out to the antenna, this project takes that network Software Defined Radio Receiver and puts it on the balcony providing th...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/weather-station/" class="btn btn-outline-primary" prompt="Older"><p>Weather Station</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/jaredquinn">Jared Quinn</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/homeassistant/">homeassistant</a> <a class="post-tag" href="/tags/smarthome/">smarthome</a> <a class="post-tag" href="/tags/pi/">pi</a> <a class="post-tag" href="/tags/sdr/">sdr</a> <a class="post-tag" href="/tags/esp/">esp</a> <a class="post-tag" href="/tags/sbc/">sbc</a> <a class="post-tag" href="/tags/software/">software</a> <a class="post-tag" href="/tags/camera/">camera</a> <a class="post-tag" href="/tags/can/">can</a> <a class="post-tag" href="/tags/gps/">gps</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-HJW3RZNZYR"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-HJW3RZNZYR'); }); </script>
