[ { "title": "Xiaomi Aqara Button Homeassistant Blueprint", "url": "/posts/xiaomi-lights/", "categories": "Smart Home", "tags": "smarthome, homeassistant", "date": "2021-11-09 00:00:00 +1100", "snippet": "ActionsI love these Xiami buttons and used them to replace all of the light switches in the house, each button is configured so that: Single tap - nearest light Double tap - next nearest light Long press - make any light on bright (or brighten both if both off)The blueprint supports any lighting entities/areas or devices as the two targetdevices; any button as the input, however it must contain the ‚Äòclick_type‚Äô attributewith a value of ‚Äòsingle‚Äô, ‚Äòdouble‚Äô or ‚Äòlong_click_press‚Äô, in the event data, while it may work with other buttons it will always work best with Xiaomi Aqara buttons.Products required Xiaomi Aqara ZigBee Buttons üõí Xiaomi Aqara ZigBee Gateway üõíI strongly encourage folks to consider a full DIY ZigBee solution utilising aUSB ZigBee radio, along the lines of ConBee Universal USB ZigBee Radio üõíImport this BlueprintImport this Blueprint to your Home Assistant instance using the URL: https://vk2way.id.au/posts/xiaomi-lights/xiaomi_lights.yaml" }, { "title": "PrettyFly (Emoji Heavy) ADS-B Report Generator", "url": "/posts/prettyfly/", "categories": "Radio, ADS-B", "tags": "software, pi, sdr", "date": "2021-11-02 00:00:00 +1100", "snippet": "Warning: This is a work in progressPrettyFly is a first attempt at turning ADS-B data into interesting reports; it depends on Tar1090 from wiedehopf. PrettyFly is currently onlyable to travel back in time the duration of tar1090‚Äôs flight path archive.usage: prettyfly [options]optional arguments: -h, --help show this help message and exit --hours HOURS --data-dir [DATA_DIR] --tar-rundir [TAR_RUNDIR] --tar-db [TAR_DB] --lon LON --lat LATPrettyFly requires the tar1090 database and runtime directories for processing the data archive.Project source code: PrettyFly" }, { "title": "Aquarium Monitor ESP8266/MQTT", "url": "/posts/aqua-mon/", "categories": "Electronics, Smarthome", "tags": "smarthome, homeassistant, mqtt, esp", "date": "2021-10-29 00:00:00 +1100", "snippet": "Coming Soon" }, { "title": "Take Full Control of your Smart Home", "url": "/posts/take-full-control/", "categories": "Smart Home", "tags": "smarthome, homeassistant, talks, video", "date": "2021-10-28 00:00:00 +1100", "snippet": "On 29th August 2019 I presented a talk at Sydney Infrastructure Coder‚Äôs meetup ‚ÄúHouse coders‚Äù:You can find more events from Sydney Infrastructure Coders at meetup.com‚Üó.Projects Mentioned Welcome to my Smart Home Xiaomi Button Blueprint Aquarium Monitoring ESP8266" }, { "title": "Welcome to my Smart Home", "url": "/posts/homeassistant/", "categories": "Smart Home", "tags": "smarthome, homeassistant", "date": "2021-10-27 00:00:00 +1100", "snippet": "Software Ecosystem Ubuntu 21.10 on Intel NUC Homeassistant (latest) Mosquitto MQTT BrokerSmart Home Devices Google Home Google Nest Hub Google Home Mini x 2 TCL 4k Android TV JBL Android Sound Bar Amazon Echo Dot Xiaomi MiBox S (Android STB) Xiaomi Aqara Gateway Night Light Xiaomi Aqara Smart Button (x3) Xiaomi Aqara Dual Button v2 Xiaomi Aqara Temperature &amp;amp; Humidity Sensor (x2) Xiaomi Aqara Door/Window Switch Xiaomi Aqara Motion Detection (x3) Broadlink SP3Mini WiFi A/C Switch (x2) YeeLight Color LED Light Bulb (x5) TP-Link HS100 WiFi A/C Switch TP-Link Color LED Light Bulb TP-Link White LED Light Bulb Kogan SmarterHome‚Ñ¢ 10W Ambient RGBW Smart Bulb (x2) NodeMCU MQTT w/Submersible Temperature Sensor (Aquarium) NodeMCU MQTT Lounge Room Humidity/Temperature/PressureCurrently Out of Service NodeMCU MQTT FastLED LED Strip (WS2811 3m 90 LED 2A) Front Door Reed Sensor (wired to RFID Scanner)Retired Gear Broadlink RM2 Pro WiFi Infra-Red Blaster Roku Streaming Stick Kodi (Raspberry Pi) Kodi (RetroOrangePi on an OrangePi One) NodeMCU MQTT Bedroom Temperature/Humidity Sensor NodeMCU MQTT RFID Scan In/OutIncomplete Projects ESP32 based MQTT Display Panel Dangerous Prototypes USB IRToy (Infrared Recevier/Sender) Bluetooth Remote Control (for Lights)" }, { "title": "Planespotting - My ADS-B Setup", "url": "/posts/adsb/", "categories": "Radio, ADS-B", "tags": "sbc, pi, sdr", "date": "2021-10-26 00:00:00 +1100", "snippet": "Ever wondered where FlightAware or FlightRadar get all the info they show on their sites? Folks like me (and maybe you too!). This article describes what ADS-B is, how I receive it and how I display it, report on it and ultimately send it on to other folks. Project Cost Build Time Assumed Knowledge $60-$120 2hrs-1day Basic LinuxFamiliarity with Single Board Computers (eg Raspberry Pi) What is ADS-B?ADS-B is a system in which electronic equipment onboard an aircraft automatically broadcasts the precise location of the aircraft via a digital data link. The system involves an aircraft with ADS-B determining its position using GPS. A suitable transmitter then broadcasts that position at rapid intervals, along with identity, altitude, velocity and other data. Dedicated ADS-B grounds stations receive the broadcasts and relay the information to air traffic control for precise tracking of the aircraft. Automatic - Requires no pilot input or external interrogation. Dependant - Depends on accurate data from the aircraft‚Äôs navigation system (eg. GPS). Surveillance - Provides aircraft surveillance data to facilities that require the information. Broadcast - Information is continually broadcast for monitoringHere in Australia ADS-B is mandatory on all aircraft operating above FL300 (30,000ft).ADS-B data is broadcast every half-second at 1090MHz using a 50kHz pulse-poition modulated digital data link, and has a very digital look when viewed on an RF waterfall:Broadcasts may include: Flight Identification (flight number callsign or call sign) ICAO 24-bit Aircraft Address (globally unique airframe code) Position (latitude/longitude) Position integrity/accuracy (GPS horizontal protection limit) Barometric and Geometric Altitudes Vertical Rate (rate of climb/descent) Track Angle and Ground Speed (velocity) Emergency indication (when emergency code selected) Special position identification (when IDENT selected) The ability of a ground station to receive a signal depends on altitude, distance from the site and obstructing terrain. The maximum range of each ground station can exceed 250 nautical miles. In airspace immediately surrounding each ground station, surveillance coverage extends to near the surface.My ADS-B Receiver SetupThis is the second generation of ADS-B receiver running at my station; the first generation was located on my balcony and not capable of 24x7 operation; this has since been relocated witha dedicated Orange Pi, reciever and antenna.You can substitute anything you want for the Orange Pi, as long as it can run Linux (Armbian ideally if you want to make it as easy as my setup was) and has USB support for the USB SDR Dongle. I am a huge fan of the Orange Pi PC (1GB) model as you can pick it up from the official store for around $40AUD. Orange Pi One üõí or the Official Shenzen Xunlong Store‚Üó on AliExpress. Nooelec NESDR SMArt v4 Software Defined Radio üõí ¬ºŒª Mini Whip (trimmed supplied antenna) Be aware also many RTL-SDRs are NOT well engineered and have large drifts or are only designed to pick up strong broadcast FM/DVB-T signals, read reviews and buy from a reputable source. I highly recommend this one.Optional Extras 17th Nov 2021 Edit: While building the double Moxon array antenna for 70cm satellite work the LNA and DC-Filter destined for that project are being tested on my ADS-B project. This will be occuring for the next week and a decision will be made as to modifications to the ADS-B configuration based on the performance of these devices. Noelec LNA üõí Noelec DC-Block üõíGetting StartedThe first task was to take the mini magnetic mount antenna and fix it. We do this by trimming it down to an exact ¬º wavelength required for 1090Mhz reception - or 69mm to the base or ground plane.My antenna is currently mounted outside my bedroom window and is operating without a ground plane,the next thing I plan to rectify to improve. While located along a north facing wall of a innercity apartment building; this antenna currently provides a reasonable range.As with all radio receiving, the placement of the antenna seems to have way more impact on your reception than any particular antenna and I‚Äôve experimented with various antennas in this setup overthe last few months even the improvement by adding a simple ground plane to this antenna wasn‚Äôt worthattracting unwanted attention to it. 1090Mhz is in the gigahertz range and as we increase in frequencyRF signals penetrate less material, line of site is ideal, so pick a place with a nice large sector of the sky visible if possible for the placement of your antenna.Typical Air Traffic and RangeA typical 48 hours of flight paths picked up by my receiver looks like:The current setup easily picks up most traffic within 50nm and regularly reaches closer to 100nm. This was greatly improved with a ground plane on the antenna as was used during the first generationof this project however a more concealed antenna was required for 24x7 operation.The Nuts and BoltsMaking use of the current infrastructure at home including the 24x7 server controlling Home Assistant,MQTT and the smarthome projects; the client/server model was taken for ADS-B Monitoring.The radio and main server are seperated in my environment purely for convenience; this also allows tar1090to manage a much larger dataset and more storing and development opportunities around the ads-b data; thisdetails how that‚Äôs done.The Radio Radio1 - Orange Pi with USB RTL-SDR Dongle Armbian 21.08.3 Focal (Linux 5.10.60-sunxi)‚Üó Dump1090-mutability‚Üó Combine1090‚Üó Note: A FlightAware Pro Stick is pictured above. While I‚Äôve had excellent results with this product, it is regularly unavailable. I highly recommend the Nooelec NESDR SMArt v4 SDR linked at the top of this article.If your Orange Pi is brand new or you‚Äôre new to Orange Pi and Armbian, you should get started with the Armbian Getting Started Guide‚Üó.Regardles of which Linux you‚Äôre on you‚Äôll want to make sure that the RTL DVB kernel modules are disabled to allowaccess for the RTL-SDR drivers.blacklist dvb_usb_rtl28xxublacklist rtl2832blacklist rtl2830You can rebuild the module dependency tree by running sudo depmod -aDump1090I‚Äôve been using the packaged version of dump1090-mutability that‚Äôs in the apt repositories for Armbian;just apt install dump1090-mutability to get it running. Configurtion is very straight forward, use yourfavourite text editor to update the /etc/default/dump1090-mutability file.You‚Äôll definitely want to update your LON and LAT to as close as you can find for the location of your antenna. I do this to 6 decimal places. DEVICE is useful if you‚Äôre running more than one radio on your computer. I have no problems decoding ADS-B with GAIN set to ‚Äúmax‚Äù and if you‚Äôve got a good dongle PPM can beleft at 0 (though with some cheap dongles I‚Äôve seen this need to go as high as 160!).Dump1090 has it‚Äôs own web interface to show you what‚Äôs in the air right now around you; you can reach thisat http://IP-ADDRESS/dump1090 if you have lighttpd running and have installed dump1090 from the Armbian packages. Note: Sydney Airport has a noise curfew overnight and we see little traffic in this area until 6am. This screen shot was taken at 0100 hours, local time.If you‚Äôre not running a split client/server model, you should leave this combine1090 step out, it‚Äôs only useful for pushing data between dump1090 instances. You can run tar1090, PrettyFly and the data feeders mentioned in the Server section on the same device runningyour radio.Combine1090Combine1090 is used to forward the ADS-B traffic between the dump1090 protocol using the defined networkports; usually this is setup on the server side to connect to the remote radio but it made much more sense in thisconfiguration for the radio to run in push mode. Under the hood Combine1090 is just a shell script and systemd startupwrapper around the swiss-army knife utility familiar to every network and system administrator, nc (netcat). This simplyconnects one port to another in a pipe for you, in our case the output RAW data from dump1090 on our radio to the RAW in-port on dump1090 running on our server (below for the server-end).This additionally allows either, or both radio1 and radio3 to take the role of ADS-B monitoring; which isuseful when one is taken offline for maintenance, upgrades or changes.Configuration of combine1090 is performed through environment variables configured in the /etc/default/combine1090 file;SOURCES=127.0.0.1PORTS=30005TARGET=houseserver.lan:30004Restart tar1090 using systemctl restart combine1090You should leave the dump1090 options (RECIEVER/DECODER and last few lines of the default config) commented out and utilise the packaged dump1090-mutability (or dump1090-fa from piaware) for Armbian.I highly recommend you add the rtl-sdr package as well for other handy tools (like rtl_tcp to remote control the radio across the network, but more on this in a future post)! Combine1090 will keep trying to connect until your server is online, so move on to the next section already.The ServerThe server already existed on my network; if you‚Äôre running without it you can leave combine1090 off for now. It‚Äôs worth considering the split as tar1090‚Äôs data storage is not well optimised for large amounts of data, and I now keep 48 hours offight history in the tar1090 data file. On Server Ubuntu 21.10 Dump1090-mutability‚Üó Tar1090‚Üó If you chose to run tar1090 directly on a Pi, be aware of the processing time required for a large number of flights and adjust your retention time.Tar1090Tar1090 provides a better map and UI in my opinon than dump1090 but the more powerful feature it provides is time travel - being ableto view your history for it‚Äôs set retention period.Once installed alongside lightttpd (or nginx in my case, however nginx reverse proxy configuration is beyond the scope of thisarticle) you can find tar1090 at http://IP-ADDRESS/tar1090 and for the historic view http://IP-ADDRESS/tar1090?pTracks. Note: The ‚Äòrange‚Äô screenshot earlier in this article shows tar1090 with the ‚ÄòpTracks‚Äô URL query-string argument.Installation is very easy, following the instructions from the tar1090 project; once installed you can modify the /etc/default/tar1090 file and modify the relevant variables.The important one to update:# hours of tracks that /?pTracks will showPTRACKS=48Restart tar1090 using systemctl restart tar1090Related Projects PrettyFly - Prettified ADS-B reporting, work in progress.The PrettyFly project is a work in progress which I will soon be developing further. The current version utilises thetar1090 pTracks data files (hence the 48 hour rentention I like to run), but later research has indicated that the raw or CSVprotocol from dump1090 would be easier to process into the kind of reports I want to run. For now though check out thepage above for some of the reporting that is done by this first foray into writing code to report on ADS-B data.Some exampel output from PrettyFly:By Country of Registration 1. üá¶üá∫ Australia (124) 2. üá∫üá∏ United States (11) 2. üá®üá≥ China (11) 3. üá∏üá¨ Singapore (8) 4. üá≥üáø New Zealand (4) 5. üá¶üá™ United Arab Emirates (3) 5. üá≤üáæ Malaysia (3) 6. üáπüáº Taiwan (2) 6. üáØüáµ Japan (2) 7. üáπüá≠ Thailand (1) 7. üá±üá∞ Sri Lanka (1) 7. üá∞üá∑ South Korea (1) 7. üá∑üá∫ Russia (1) 7. üá∂üá¶ Qatar (1) 7. üáµüá≠ Philippines (1) 7. üá¨üá∑ Greece (1) 7. üá´üáØ Fiji (1)Along with more detailed categorisation and reporting:Flights of Interestüöë Medical 9: VH-RFD/AM228, VH-RFD/AM293, VH-RFD/AM277, VH-AMQ/AM242, VH-PWX/AE913, VH-ZSU/CFH23, VH-AMR/AM214, VH-NAJ/AM227, VH-ZCY/CFH21‚õë Rescue 1: VH-TJE/RSCU201‚úàÔ∏è RAAF 4: A36-002/ASY326, A97-465/TROJ26, A30-003/WGTL15, A56-003/EVY55üí£ Military Contractor 4: VH-SLF/FRSC11, VH-SLF/FRSC31, VH-LJU/FRSC12, VH-LRH/FRSC32It was named PrettyFly mostly because of it‚Äôs unapologetic use of emoji.You can find the PrettyFly project at https://github.com/jaredquinn/prettyfly‚Üó, including the(almost) daily updated data/*.json files for operators and aircraft classification.Data FeedersIf you‚Äôre going to run this kind of receiver, it‚Äôs worth feeding the data to FlightAware at minimum as the benefits they provide (buiness plan access) is worth it alone; however as a believer in open-data and sharing, I particularly like ADSBHubas they will provide the global ‚Äòfirehose‚Äô of ADS-B data from all 2,000 contributors in their community.I feed data to: ADS-B Hub Station VK2WAY/SYD1‚Üó FightAware - FlyByNightSydney‚Üó OpenSky Network‚Üó FlightRadar 24 (Radar T-YMCO1)Running the split client/server mode also gives me the benefit of running all my data feeders in the centralised location, not requiringa setup on each of the radio receiver devices or future versions of it, making configuration management much easier." }, { "title": "The Balcony Radio and Camera", "url": "/posts/balcony-cam/", "categories": "Radio, ADS-B", "tags": "sbc, sdr", "date": "2021-10-25 00:00:00 +1100", "snippet": "Project Details Coming Soon" }, { "title": "Introducing The Dirge (A CAN Bus)", "url": "/posts/the-bus/", "categories": "Electronics, The Dirge CAN Bus Module", "tags": "can, esp, iot", "date": "2021-10-24 00:00:00 +1100", "snippet": "Dirge‚Äôs BusIntro‚Ä¶The ‚ÄúDirge‚Äù SensorThe Sensor Project on GitHubFeatures TPS54202 Based 12V to 5V Converter Dual AO4407A 30V 12A Switching channels (12V SW1 &amp;amp; SW2) 12V Input Voltage Monitoring AHT20 Temperature/Humidity Sensor Jumper selectable Supply MCU 5V from USB, 5V BUS or 12V Supply Enable/Disable 12V to 5V buck jumper MCP2562 / MCP2515 5V CAN (Controller Area Network) Bus Driver 4 Normally Open Button Inputs (supports momentary &amp;amp; toggles) 2 TTL (3V3) Output Signals (not for power supply) TXB0104PWR IC 4bit Bi-directional Level Shifter UART TX / RX LED Pixel Pusher 5V Data CH1/CH2 6 DIP Switches 1-4=Config/Multiplexed with BTN INs 5=Enable 5V Level Shifter PXL/UARTs 6=Terminate CAN bus with 120Ohm " }, { "title": "Welcome to vk2way.id.au", "url": "/posts/welcome/", "categories": "General", "tags": "website", "date": "2021-10-23 00:00:00 +1100", "snippet": "Of course I need to start another project, it wouldn‚Äôt be a day in the life of without! But here we are again at the start of something new.I am patiently waiting out the time between sitting &amp;amp; passing the assessment (the Certificate of Proficiency required for the Foundation Level Amature Radio icense) and the Australian Communications &amp;amp; Media Authority granting my license and callsign. As you can probably tell already the callsign that has been granted is VK2WAY - Whiskey - Alpha - Yankee.I decided to put this blog up, firstly because it‚Äôs been years since I regularly commited to writing regularly, but more importantly because I want to collect information on all the related projects in one place. This will include electronics, programming, radio and just about anything else that takes my fancy." } ]
